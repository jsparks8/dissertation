model <- "
model                                                                                                          
{  
       
# specify prior distributions   
                                                                                                           
for (j in 1:J) {		
	b[j] ~ dnorm(0,1);
	a[j] ~ dnorm(0,4);
	tau[j,1] <- 0;
}		

for (j in 1:J){                                                                                                         
	for (k in 2:K){                                                                                                        
           tau[j,k] ~ dlnorm(0, 1);                                                                         
}                                                                                                                       
}	

#specify model
for (i in 1:N) {				
  theta[i] ~ dnorm(0,1);
  for (j in 1:J) {	
     for (z in 1:K){
	cp[i,j,z]<- exp(a[j]*((z-1)*(theta[i]-b[j] )+ sum(tau[j,1:z])))+ exp(a[j]*(((2*K)-z)*(theta[i]-b[j] )+ sum(tau[j,1:z])));
     }
     den[i,j] <- sum(cp[i,j,1:K]);
     for (z in 1:K){
	prob[i,j,z] <- cp[i,j,z]/den[i,j];	
     } 
     r[i,j] ~ dcat(prob[i,j,]);	
  }
}
}   "          
 
# specify parameters
# N is sample size
# J is number of items
# K is response categories
# D is number of dimensions
                                  
resp <- matrix(data, nrow=1000, ncol=20, byrow=TRUE)
N <- 1000
J <- 20
K <- 4

data_list <- list("r" = resp, "N" = N, "J" = J, "K" = K)

# specify starting values for all estimated parameters
#n <- 20
#m <- 4
#z <- matrix(NA, n, m)
#for (i in 1:n) { 
#  z[i,] <- sort(rnorm(m))[rank(-tau[i,])]
#  z[i,] <- z[i,] - z[i,m]
#}
#[,-ncol(tau)]

starts <-  list(a=
c(0.7773,
  1.5536,
  1.36,
  0.7521,
  1.9158,
  1.9152,
  0.6937,
  1.7502,
  1.202,
  1.325,
  1.329,
  0.8583,
  1.6408,
  0.7712,
  1.1079,
  1.7803,
  1.9646,
  0.8387,
  1.1672,
  0.6125
),
b=c(
  -2	,
  -2	,
  -1.1999	,
  -1.0397	,
  -0.5966	,
  -0.3927	,
  0.0049	,
  0.0358	,
  0.2896	,
  0.4177	,
  0.4323	,
  0.4772	,
  0.7922	,
  0.8786	,
  0.9818	,
  1.0128	,
  1.5896	,
  1.7822	,
  1.9547	,
  2	),
tau=matrix(c(
  NA	,	1.2752	,	1.0967	,	0.862	,
  NA	,	1.435	,	1.1038	,	0.9322	,
  NA	,	1.2133	,	0.9914	,	0.7751	,
  NA	,	1.1386	,	0.8823	,	0.5562	,
  NA	,	1.4605	,	1.1903	,	0.9154	,
  NA	,	1.2093	,	0.9921	,	0.6625	,
  NA	,	1.0407	,	0.8707	,	0.6329	,
  NA	,	1.1541	,	0.9233	,	0.6769	,
  NA	,	1.0272	,	0.7738	,	0.5312	,
  NA	,	0.8558	,	0.6416	,	0.4396	,
  NA	,	0.995	,	0.7819	,	0.5654	,
  NA	,	1.1821	,	0.9189	,	0.5862	,
  NA	,	0.8971	,	0.6528	,	0.4253	,
  NA	,	1.0792	,	0.8118	,	0.5108	,
  NA	,	0.966	,	0.7181	,	0.51	,
  NA	,	1.2384	,	1.0247	,	0.8533	,
  NA	,	1.112	,	0.8099	,	0.5728	,
  NA	,	1.489	,	1.2081	,	0.9207	,
  NA	,	1.2293	,	0.9372	,	0.6416	,
  NA	,	1.2541	,	1.0605	,	0.7436	
), ncol=4, nrow=20, byrow=TRUE),
theta = c(
  0.996	,
  -1.6958	,
  -0.5334	,
  -1.3723	,
  -2.2079	,
  1.8221	,
  -0.6534	,
  -0.2847	,
  -0.3869	,
  0.3867	,
  1.6004	,
  1.6812	,
  -1.1836	,
  -1.3585	,
  -1.5127	,
  -1.2531	,
  1.9594	,
  0.0076	,
  -0.8426	,
  -0.6012	,
  1.0745	,
  0.2606	,
  -0.3143	,
  -0.7496	,
  -0.8622	,
  2.048	,
  0.9399	,
  2.0087	,
  -0.4214	,
  -0.3508	,
  -1.0274	,
  -0.2505	,
  0.4719	,
  1.3589	,
  0.5642	,
  0.456	,
  1.231	,
  1.1471	,
  0.1066	,
  -0.7833	,
  1.2412	,
  0.1389	,
  1.7106	,
  -0.4306	,
  -1.0442	,
  0.5376	,
  -0.6696	,
  0.6388	,
  -1.724	,
  -1.7424	,
  0.6898	,
  0.331	,
  0.8711	,
  -2.0162	,
  1.2126	,
  1.2005	,
  1.0321	,
  0.7864	,
  2.1101	,
  -1.4538	,
  -0.5831	,
  0.4097	,
  -0.807	,
  0.0856	,
  0.7462	,
  -0.6537	,
  0.6571	,
  0.5499	,
  -0.8067	,
  -0.9974	,
  0.9759	,
  -0.1694	,
  0.7222	,
  -0.8444	,
  1.2773	,
  -1.3431	,
  0.7653	,
  0.4642	,
  0.268	,
  0.6675	,
  0.3985	,
  -0.6381	,
  -0.2677	,
  0.3599	,
  -1.3129	,
  -0.884	,
  2.0771	,
  -2.0992	,
  -1.2385	,
  0.9904	,
  1.0887	,
  0.8399	,
  0.0569	,
  0.3239	,
  -0.9047	,
  -0.6522	,
  -0.2625	,
  -0.9347	,
  0.8212	,
  -1.6243	,
  -1.0304	,
  -1.2619	,
  0.3922	,
  -1.1314	,
  0.5441	,
  1.1766	,
  0.0252	,
  0.5151	,
  -0.6541	,
  0.5036	,
  -1.2721	,
  -0.0768	,
  -1.3453	,
  -0.2663	,
  1.0876	,
  0.7006	,
  -0.4428	,
  -0.7885	,
  -0.8568	,
  -0.7464	,
  0.298	,
  -1.0196	,
  2.8709	,
  0.2187	,
  -0.9666	,
  0.3838	,
  -0.1219	,
  -0.3505	,
  0.5995	,
  0.2313	,
  1.0262	,
  -0.5244	,
  1.7962	,
  -1.4342	,
  0.1387	,
  0.4515	,
  1.2148	,
  -1.3245	,
  -1.1396	,
  1.6756	,
  0.3981	,
  0.7155	,
  -0.7932	,
  1.9239	,
  0.0704	,
  0.4693	,
  -0.0899	,
  0.8942	,
  -0.3737	,
  2.2583	,
  1.5731	,
  -1.9543	,
  -0.6193	,
  -0.0299	,
  -1.7217	,
  -1.0535	,
  -0.5707	,
  0.4827	,
  0.0959	,
  -0.5878	,
  -0.0818	,
  2.8884	,
  1.1728	,
  0.5496	,
  0.7791	,
  -0.5651	,
  0.103	,
  0.2815	,
  -0.4744	,
  -0.458	,
  0.5015	,
  -0.4051	,
  -0.1774	,
  -0.3195	,
  0.8435	,
  0.4837	,
  -0.3037	,
  -0.2851	,
  0.9804	,
  -0.1713	,
  1.343	,
  -0.0984	,
  -0.322	,
  -1.9147	,
  -0.647	,
  -1.3994	,
  1.9312	,
  0.4616	,
  0.5274	,
  -0.0367	,
  -2.7202	,
  -0.0471	,
  0.0047	,
  -1.2253	,
  0.2509	,
  1.6052	,
  -0.0355	,
  1.0294	,
  -0.4	,
  0.0672	,
  2.0358	,
  0.6495	,
  1.2794	,
  -0.6282	,
  1.3503	,
  1.6726	,
  1.1727	,
  0.0062	,
  1.3055	,
  -0.093	,
  -1.1287	,
  0.5873	,
  0.0892	,
  -0.233	,
  1.4878	,
  -0.3541	,
  0.4186	,
  -2.0974	,
  -1.3705	,
  -0.6845	,
  -0.3181	,
  -0.3155	,
  0.8843	,
  -1.8854	,
  0.7322	,
  0.7905	,
  0.1949	,
  0.9212	,
  1.2415	,
  -0.6812	,
  0.5153	,
  -0.4682	,
  -0.5021	,
  -1.974	,
  -0.5694	,
  0.4753	,
  1.2172	,
  0.1177	,
  0.0884	,
  -0.2006	,
  -0.4986	,
  1.0897	,
  0.9216	,
  0.3646	,
  0.2951	,
  0.5299	,
  0.9688	,
  1.9086	,
  1.5028	,
  -0.3118	,
  0.948	,
  -0.0877	,
  -0.1937	,
  0.7292	,
  1.0284	,
  -0.3072	,
  0.7657	,
  -0.0215	,
  1.4925	,
  0.4477	,
  0.175	,
  0.3872	,
  -1.2889	,
  0.2315	,
  0.7201	,
  -0.2514	,
  -0.319	,
  0.9834	,
  0.8282	,
  0.3828	,
  1.4557	,
  0.6665	,
  -0.37	,
  1.5483	,
  2.3293	,
  1.3994	,
  -0.9412	,
  0.8333	,
  0.7349	,
  0.1232	,
  1.5554	,
  1.4233	,
  -0.3588	,
  -0.4977	,
  -1.885	,
  -1.1396	,
  -0.4567	,
  1.1733	,
  -0.3202	,
  0.0417	,
  -0.177	,
  2.2847	,
  -0.8036	,
  1.2306	,
  -0.0344	,
  -0.6624	,
  -0.2496	,
  2.5331	,
  0.1581	,
  0.752	,
  -0.4277	,
  -0.7387	,
  0.1436	,
  -0.715	,
  1.3165	,
  -1.5743	,
  0.0462	,
  -0.0285	,
  1.4131	,
  0.8292	,
  0.1834	,
  1.3396	,
  1.2023	,
  0.8718	,
  -0.1164	,
  0.3428	,
  -0.9855	,
  1.1277	,
  0.2298	,
  0.9186	,
  -0.2141	,
  -2.7218	,
  -1.0143	,
  -0.8291	,
  0.8577	,
  -0.2385	,
  -0.7032	,
  -2.4522	,
  1.148	,
  0.0021	,
  0.0609	,
  -1.105	,
  0.2007	,
  -1.2306	,
  -0.1265	,
  -1.3128	,
  1.1077	,
  -1.0077	,
  1.5758	,
  0.291	,
  0.7395	,
  -1.2556	,
  1.412	,
  0.7335	,
  1.2817	,
  0.8988	,
  0.5311	,
  0.7846	,
  -1.1852	,
  0.346	,
  -1.1729	,
  -0.337	,
  -1.0242	,
  1.3248	,
  0.0375	,
  -0.0773	,
  -0.4405	,
  0.2143	,
  -0.0118	,
  -0.4531	,
  -2.1019	,
  -0.2826	,
  -1.571	,
  0.2964	,
  0.2474	,
  -0.137	,
  -0.7143	,
  1.0654	,
  -2.0203	,
  0.506	,
  -0.6122	,
  0.0263	,
  -0.2531	,
  -0.9788	,
  1.5817	,
  -0.269	,
  -0.5055	,
  2.0773	,
  0.6699	,
  0.2041	,
  -0.0372	,
  0.116	,
  -0.256	,
  -0.6746	,
  0.942	,
  0.493	,
  0.4438	,
  -0.07	,
  1.3019	,
  -1.3593	,
  1.5544	,
  1.4485	,
  0.9283	,
  -1.3073	,
  0.2766	,
  -0.7992	,
  -0.3769	,
  -0.6056	,
  -2.4272	,
  -0.513	,
  -1.0719	,
  0.1374	,
  -0.895	,
  -0.0786	,
  1.5958	,
  -1.204	,
  -1.6623	,
  0.0693	,
  -0.9482	,
  -0.9512	,
  0.8681	,
  0.1585	,
  1.2961	,
  -1.0844	,
  0.3928	,
  -0.026	,
  -1.256	,
  -0.9357	,
  -0.1967	,
  0.1423	,
  -0.4598	,
  0.6179	,
  -0.7204	,
  -0.5835	,
  0.2163	,
  1.245	,
  -0.7679	,
  1.2131	,
  -1.1443	,
  1.4702	,
  -1.5024	,
  0.1418	,
  -1.5564	,
  2.1764	,
  0.2952	,
  0.4445	,
  1.8182	,
  0.6357	,
  -0.0123	,
  0.811	,
  0.1501	,
  0.8171	,
  0.4084	,
  0.1426	,
  -0.1036	,
  0.7019	,
  1.0407	,
  0.0491	,
  1.7543	,
  0.0522	,
  -2.0663	,
  -0.3706	,
  1.6931	,
  1.1503	,
  -0.1046	,
  -0.5157	,
  1.5237	,
  -0.3259	,
  1.2508	,
  0.6513	,
  0.0921	,
  -0.0638	,
  -0.836	,
  1.7287	,
  -0.9671	,
  0.5664	,
  -0.4506	,
  -1.0979	,
  -1.2546	,
  2.1567	,
  0.3402	,
  0.537	,
  0.9584	,
  1.4218	,
  -0.1663	,
  0.7882	,
  -0.6263	,
  2.0095	,
  1.4813	,
  0.1647	,
  0.7424	,
  -0.7645	,
  1.4615	,
  -1.3541	,
  -1.2179	,
  1.4385	,
  2.689	,
  1.3901	,
  1.1019	,
  -0.2717	,
  1.1522	,
  0.7203	,
  0.0646	,
  -0.0697	,
  1.1948	,
  -1.1346	,
  1.0648	,
  0.0511	,
  0.8078	,
  1.3419	,
  -0.5507	,
  0.6337	,
  -0.3248	,
  0.8461	,
  0.017	,
  -0.3255	,
  -0.8858	,
  -0.3314	,
  -0.0105	,
  1.4334	,
  -0.7544	,
  0.4962	,
  -0.868	,
  -0.1116	,
  0.1995	,
  -1.6455	,
  0.786	,
  -0.1529	,
  -1.563	,
  -1.0697	,
  -1.1151	,
  -0.1142	,
  -0.8946	,
  -0.6541	,
  1.1787	,
  0.9515	,
  0.1079	,
  1.5858	,
  0.8261	,
  -0.9054	,
  -0.3814	,
  -1.217	,
  0.5189	,
  0.5417	,
  0.1301	,
  -0.2494	,
  0.9599	,
  -1.2716	,
  -0.5642	,
  0.2832	,
  -0.5404	,
  0.7615	,
  0.1185	,
  0.0906	,
  1.306	,
  0.352	,
  -0.7969	,
  -1.8321	,
  1.1025	,
  -1.4557	,
  -0.2033	,
  0.7801	,
  -0.9959	,
  1.2736	,
  0.2145	,
  -0.7084	,
  2.0628	,
  -0.8142	,
  -0.0264	,
  0.8592	,
  -0.4622	,
  -1.9619	,
  -1.519	,
  -0.8604	,
  -0.4821	,
  0.7727	,
  -1.1892	,
  0.3721	,
  -0.944	,
  -0.6051	,
  1.3137	,
  1.735	,
  0.4284	,
  -1.0488	,
  1.5003	,
  0.1236	,
  -0.3601	,
  -1.1026	,
  -1.086	,
  -0.9803	,
  -0.8851	,
  1.972	,
  1.7218	,
  -0.9609	,
  1.157	,
  -0.5944	,
  0.6757	,
  -0.6028	,
  -1.666	,
  1.2497	,
  -1.5311	,
  0.3566	,
  -0.6588	,
  2.3137	,
  -0.015	,
  -0.7748	,
  -0.7182	,
  0.0887	,
  -0.4706	,
  -1.7303	,
  -1.6112	,
  0.2411	,
  0.1533	,
  -0.5932	,
  -0.5944	,
  0.4176	,
  -0.4715	,
  -0.2919	,
  -0.4106	,
  -0.2443	,
  0.1448	,
  -0.8359	,
  0.9914	,
  -0.4516	,
  0.1438	,
  0.0461	,
  -0.7616	,
  -0.4386	,
  0.7351	,
  0.6338	,
  1.2387	,
  0.2319	,
  -0.3144	,
  1.4997	,
  0.0696	,
  1.334	,
  0.1822	,
  -0.0961	,
  -0.8505	,
  0.2695	,
  -2.259	,
  1.1788	,
  0.9021	,
  0.6267	,
  0.251	,
  0.5526	,
  0.9508	,
  -0.7145	,
  1.8917	,
  1.3953	,
  0.1134	,
  0.375	,
  1.4645	,
  -1.2422	,
  -0.7027	,
  0.8673	,
  -0.0933	,
  1.2634	,
  -2.6862	,
  -0.9057	,
  0.7092	,
  2.0948	,
  1.1253	,
  0.3772	,
  1.1092	,
  0.6389	,
  -0.3588	,
  -1.7317	,
  1.8912	,
  -0.3316	,
  0.2087	,
  1.7345	,
  0.9777	,
  0.5602	,
  -0.3638	,
  -0.4439	,
  -0.3867	,
  1.832	,
  0.8453	,
  0.3306	,
  0.4217	,
  -0.4351	,
  0.2056	,
  -1.5686	,
  -0.0178	,
  0.1035	,
  -0.8348	,
  -1.1946	,
  -0.7222	,
  0.003	,
  -0.3407	,
  0.342	,
  -0.3732	,
  -0.0157	,
  2.6042	,
  0.6724	,
  0.1395	,
  -1.0244	,
  -0.2876	,
  -0.8507	,
  1.1346	,
  -0.2369	,
  -0.5776	,
  0.3692	,
  -0.5708	,
  0.4637	,
  -1.895	,
  0.2038	,
  -0.081	,
  -1.5097	,
  -0.0115	,
  -1.1496	,
  0.1164	,
  0.3473	,
  0.5469	,
  -0.5181	,
  1.2951	,
  0.9531	,
  -0.0967	,
  0.3941	,
  1.5372	,
  0.3694	,
  -1.1276	,
  -0.1962	,
  -0.2644	,
  -0.3901	,
  0.0174	,
  -0.2912	,
  1.1658	,
  2.4321	,
  -0.629	,
  -2.2743	,
  0.3349	,
  -0.2137	,
  -0.0315	,
  -0.6961	,
  0.9684	,
  2.3963	,
  1.4761	,
  -0.4672	,
  -0.5894	,
  -0.9875	,
  0.1607	,
  -1.6956	,
  -0.1543	,
  -0.5642	,
  -1.8865	,
  -0.3518	,
  0.3042	,
  -1.3213	,
  -1.4572	,
  1.1475	,
  1.2125	,
  0.1586	,
  -1.7624	,
  0.2602	,
  0.1621	,
  -1.5185	,
  -0.1874	,
  2.1833	,
  0.3434	,
  1.9337	,
  -0.5608	,
  0.5196	,
  0.9809	,
  -0.3895	,
  1.1463	,
  -0.8143	,
  0.4187	,
  0.4379	,
  1.9892	,
  0.9834	,
  1.0104	,
  -1.9334	,
  0.4879	,
  -0.4625	,
  -0.1613	,
  0.0144	,
  -2.3336	,
  -0.3211	,
  -1.1246	,
  -0.2463	,
  0.8023	,
  -0.7362	,
  0.5964	,
  -0.4173	,
  2.1506	,
  -0.4634	,
  -1.3524	,
  0.6919	,
  0.8836	,
  -0.3916	,
  0.8519	,
  1.5164	,
  -0.9713	,
  1.6253	,
  -0.4775	,
  -1.0968	,
  -0.0024	,
  -1.541	,
  -0.7244	,
  0.9653	,
  -0.0861	,
  0.398	,
  -0.431	,
  -0.0297	,
  0.3579	,
  -0.3719	,
  -0.7113	,
  0.5484	,
  0.5999	,
  1.6956	,
  0.7708	,
  0.0666	,
  -1.3966	,
  0.5308	,
  -0.6602	,
  0.5847	,
  2.0986	,
  -0.8864	,
  -0.0072	,
  0.0991	,
  -1.0714	,
  -0.7662	,
  0.3917	,
  -0.497	,
  0.33	,
  0.817	,
  0.3026	,
  -0.1516	,
  0.2297	,
  1.0925	,
  0.0029	,
  -0.1326	,
  -0.0679	,
  0.3059	,
  0.6152	,
  0.0512	,
  -0.9451	,
  -0.5733	,
  2.1748	,
  0.2021	,
  1.2555	,
  1.0661	,
  1.0317	,
  3.0088	,
  -0.2693	,
  1.0419	,
  0.5899	,
  -0.7172	,
  0.6451	,
  0.9814	,
  0.0593	,
  0.0177	,
  0.3647	,
  -1.1343	,
  -0.1477	,
  0.2618	,
  -0.1791	,
  0.5779	,
  -0.4336	,
  -1.0306	,
  0.2429	,
  -0.4673	,
  1.4777	,
  -2.6393	,
  0.9748	,
  0.8178	,
  -2.1527	,
  0.1404	,
  0.3557	,
  0.0455	,
  0.4244	,
  -1.2207	,
  1.1639	,
  0.0219	,
  -1.6025	,
  0.4615	,
  0.0485	,
  -0.6392	,
  -1.1291	,
  -0.2731	,
  -1.2535	,
  1.6843	,
  0.0593	,
  0.5745	,
  -0.136	,
  0.6436	,
  -1.0761	,
  -0.0757	,
  -0.4174	,
  -0.5496	,
  0.2639	,
  -0.8402	,
  -0.9786	,
  -0.8426	,
  0.258	,
  -0.0616	,
  1.8858	,
  1.1323	,
  1.532	,
  0.2906	,
  -0.7043	,
  -1.1763	,
  -1.1612	,
  -1.5805	,
  -2.0444	,
  0.2292	,
  0.3196	,
  -0.2442	,
  0.8794	,
  -1.5789	,
  -0.5572	,
  -0.2494	,
  -0.6442	,
  0.0551	,
  -1.4205	,
  0.2802	,
  -0.9363	,
  -0.3602	,
  -0.4338	,
  0.5307	,
  0.638	,
  2.8328	,
  0.3445	,
  0.6553	,
  -1.6798	,
  -0.3355	,
  -0.1706	,
  -1.5068	,
  0.4662	,
  0.9547	,
  -0.9472	,
  0.0386	,
  -0.8309	,
  0.5572	,
  -0.1121	,
  -0.9576	,
  -0.4681	,
  1.0448	,
  0.0033	,
  1.0766	,
  0.5581	,
  0.692	,
  0.6578	,
  -0.327	,
  -0.3045	,
  -1.5549	,
  1.4703	,
  0.1623	,
  -0.2941	,
  0.8561	,
  -0.5727	,
  -0.1708	,
  -0.4061	,
  1.3306	,
  -1.3646	,
  1.4311	,
  1.1066	,
  1.2811	,
  0.0184	,
  0.6538	,
  1.395	,
  0.2885	,
  1.022	,
  -0.3294	,
  -2.058	,
  1.1794	,
  1.0803	,
  1.7113	,
  -0.586	,
  -1.446	,
  -0.8153	,
  0.1244	,
  -0.896	,
  -0.5192	,
  -0.5618	,
  -0.4097	,
  1.27	,
  0.5076	,
  -0.5481	,
  -0.0544	,
  -0.9748	,
  -1.5123	,
  -1.3958	,
  -0.7599	,
  -0.2647	,
  -0.8507	,
  0.2191	,
  -0.8985	,
  -1.6583	,
  -0.1384	,
  1.2567	,
  -0.54	,
  -0.4928	,
  1.05	,
  0.8945	,
  0.4331	,
  0.0772	,
  0.8217	,
  0.9666	,
  0.2231	,
  1.1072	,
  0.7813	,
  -0.8364	,
  0.2921	,
  1.3123	,
  0.0787	,
  1.593	,
  -0.7167	
  
)
)

