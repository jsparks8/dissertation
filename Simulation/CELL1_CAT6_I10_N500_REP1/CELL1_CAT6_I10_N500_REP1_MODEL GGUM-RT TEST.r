model <- "model {

# specify prior distributions

for (j in 1:J) {

b[j] ~ dnorm(0,0.25);

a[j] ~ dnorm(0,4);

tau[j,1] <- 0;

}

tau[1,2] ~ dlnorm(0.224035, 1);
tau[1,3] ~ dlnorm(0.103196, 1);
tau[1,4] ~ dlnorm(-0.034277, 1);
tau[1,5] ~ dlnorm(-0.193708, 1);
tau[1,6] ~ dlnorm(-0.38347, 1);
tau[2,2] ~ dlnorm(0.104934, 1);
tau[2,3] ~ dlnorm(-0.020002, 1);
tau[2,4] ~ dlnorm(-0.162807, 1);
tau[2,5] ~ dlnorm(-0.329457, 1);
tau[2,6] ~ dlnorm(-0.529545, 1);
tau[3,2] ~ dlnorm(0.064747, 1);
tau[3,3] ~ dlnorm(-0.061691, 1);
tau[3,4] ~ dlnorm(-0.206461, 1);
tau[3,5] ~ dlnorm(-0.375795, 1);
tau[3,6] ~ dlnorm(-0.579768, 1);
tau[4,2] ~ dlnorm(0.138516, 1);
tau[4,3] ~ dlnorm(0.014787, 1);
tau[4,4] ~ dlnorm(-0.126442, 1);
tau[4,5] ~ dlnorm(-0.29095, 1);
tau[4,6] ~ dlnorm(-0.487953, 1);
tau[5,2] ~ dlnorm(-0.281005, 1);
tau[5,3] ~ dlnorm(-0.423317, 1);
tau[5,4] ~ dlnorm(-0.589298, 1);
tau[5,5] ~ dlnorm(-0.788419, 1);
tau[5,6] ~ dlnorm(-1.037305, 1);
tau[6,2] ~ dlnorm(-0.291411, 1);
tau[6,3] ~ dlnorm(-0.434296, 1);
tau[6,4] ~ dlnorm(-0.601057, 1);
tau[6,5] ~ dlnorm(-0.801303, 1);
tau[6,6] ~ dlnorm(-1.051952, 1);
tau[7,2] ~ dlnorm(0.062582, 1);
tau[7,3] ~ dlnorm(-0.063938, 1);
tau[7,4] ~ dlnorm(-0.208816, 1);
tau[7,5] ~ dlnorm(-0.378299, 1);
tau[7,6] ~ dlnorm(-0.582488, 1);
tau[8,2] ~ dlnorm(-0.147668, 1);
tau[8,3] ~ dlnorm(-0.28317, 1);
tau[8,4] ~ dlnorm(-0.439955, 1);
tau[8,5] ~ dlnorm(-0.625976, 1);
tau[8,6] ~ dlnorm(-0.854694, 1);
tau[9,2] ~ dlnorm(0.102458, 1);
tau[9,3] ~ dlnorm(-0.02257, 1);
tau[9,4] ~ dlnorm(-0.165493, 1);
tau[9,5] ~ dlnorm(-0.332305, 1);
tau[9,6] ~ dlnorm(-0.532625, 1);
tau[10,2] ~ dlnorm(0.120875, 1);
tau[10,3] ~ dlnorm(-0.003484, 1);
tau[10,4] ~ dlnorm(-0.145533, 1);
tau[10,5] ~ dlnorm(-0.311155, 1);
tau[10,6] ~ dlnorm(-0.509761, 1);

  # RT stuff starts here
 for (i in 1:N) {
  	for (j in 1:J) {
 x2[i,j] <-pow((theta[i]-b[j]),2);
 
 	zx[i,j] <- ( pow((theta[i]-b[j]),2) - xm ) / xsd;
 
 
  	}
 	}
 xm <- mean(x2);
 xsd <- sd(x2);
 
   nu <- nuMinusOne+1;
  nuMinusOne ~ dexp(1/29.0);
  
# Specify priors;
z_b0 ~ dnorm( 0 , 1/2^2 );
z_b1 ~ dnorm( 0 , 1/2^2 );
z_b2 ~ dnorm( 0 , 1/2^2 );
zsigma ~ dunif( 1.0E-5 , 1.0E+1 );

for (i in 1:N) {
 	for (j in 1:J) {

	# Specify model
 	 			zrt0[i,j] <- z_b0 + z_b1*zx[i,j]+
 						z_b2*pow(zx[i,j],2);

 						#zy[i,j] ~ dnorm(zrt0[i,j],1/(zsigma^2))	;
						zy[i,j] ~ dt( zrt0[i,j] , 1/(zsigma^2) , nu );
						


 	}
 	}

# Transform to original scale:
# rt_b1 <- ( z_b1 / xsd )*ysd;
# rt_b2 <- ( z_b2 / xsd )*ysd;
# rt_b0 <- z_b0*ysd + ym - ((z_b1 * xm / xsd )+(z_b1 * xm / xsd))*ysd;
# e <- zsigma*ysd;

# ending RT stuff

  #specify model

for (i in 1:N) {
  theta[i] ~ dnorm(0,1);

  for (j in 1:J) {
    for (z in 1:K){
      cp[i,j,z]<- exp(a[j]*((z-1)*(theta[i]-b[j] )+ sum(tau[j,1:z])))+ exp(a[j]*(((2*K)-z)*(theta[i]-b[j] )+ sum(tau[j,1:z])));
    }
    den[i,j] <- sum(cp[i,j,1:K]);
    for (z in 1:K){
      prob[i,j,z] <- cp[i,j,z]/den[i,j];
    }
    r[i,j] ~ dcat(prob[i,j,]);
  }
}
}   "

# specify parameters
# N is sample size
# J is number of items
# K is response categories
# D is number of dimensions

resp <- matrix(data, nrow = 500, ncol = 10, byrow = TRUE)

rt <- matrix(datart, nrow = 500, ncol = 10, byrow = TRUE)

N <- 500

J <- 10

K <- 6


# Create standardized RT stuff to shove into model 
ym <- mean(rt)
ysd <- sd(rt)

zy <- matrix(data=NA, nrow=N,ncol=J,byrow=TRUE)

for (i in 1:N) {
  for (j in 1:J) {
    
    zy[i,j] <- ( rt[i,j] - ym ) / ysd;
    
    
  }
}

data_list <- list("r" = resp, #"rt" = rt, 
                  "N" = N, "J" = J, "K" = K,
                 # "ym"= ym, "ysd"= ysd,
                  "zy"= zy)

# specify starting values for all estimated parameters

starts <- list(
  a =
    c(1.1346, 0.619, 1.0794, 1.2106, 1.166, 1.2347, 1.4567, 0.6734, 1.1001, 0.4555),
  b = c(
    2.3979,
    1.9665,
    0.9474,
    1.177,
    0.3624,
    0.3494,
    -1.1004,
    -0.5638,
    -1.3875,
    -1.722
  ),
  tau = matrix(c(
    NA, 1.494, 1.5841, 0.7641, 1.381, 1.0886,
    NA, 1.0226, 1.4709, 3.0897, 1.0946, 2.1458,
    NA, 0.6717, 0.607, 0.8997, 0.2755, 0.272,
    NA, 0.8309, 1.3117, 0.9402, 0.995, 0.2668,
    NA, 0.8566, 0.7925, 1.2203, 0.4374, 0.3,
    NA, 0.9477, 0.749, 1.1806, 0.3917, 0.2701,
    NA, 2.1083, 1.8707, 2.0195, 1.4912, 1.0473,
    NA, 1.343, 1.2332, 2.4754, 1.3666, 1.554,
    NA, 2.2743, 2.2389, 1.4565, 2.0023, 1.1698,
    NA, 0.7561, 1.0673, 2.1797, 0.6444, 0.4798
  ), ncol = 6, nrow = 10, byrow = TRUE),

  #  rt_e[i]
#  rt_b0 = c(4545.575),
#  rt_b1 = c(459.497),
#  rt_b2 = c(-31.068),
  theta = c(
    0.0796,
    1.0981,
    2.5196,
    0.3169,
    0.6414,
    -0.5729,
    0.2371,
    0.2053,
    0.2242,
    -0.1052,
    -0.6177,
    -1.4948,
    2.1524,
    0.653,
    0.5363,
    -1.4389,
    1.2495,
    -0.2779,
    -0.4929,
    0.4308,
    -0.0898,
    -1.251,
    0.905,
    1.6311,
    -1.2987,
    0.0977,
    -1.0232,
    0.392,
    -0.237,
    -1.3569,
    -0.4017,
    0.7372,
    -0.8778,
    -0.2202,
    1.1423,
    -0.8222,
    -0.1434,
    -1.1363,
    -0.8426,
    -0.5042,
    -0.6562,
    0.4308,
    0.2275,
    0.1563,
    1.725,
    0.4696,
    -0.425,
    1.1645,
    0.9374,
    -0.9247,
    1.068,
    -0.9004,
    -1.3762,
    1.2809,
    -0.4343,
    2.1709,
    0.0873,
    -1.2054,
    -2.1149,
    0.0087,
    0.8987,
    1.2792,
    -0.539,
    1.15,
    -0.5943,
    1.1139,
    -0.4593,
    -2.6736,
    0.6645,
    -1.0409,
    -0.1202,
    1.1277,
    -0.141,
    1.492,
    0.1696,
    1.4081,
    -0.3181,
    -0.0394,
    0.0925,
    -1.7624,
    0.0798,
    0.0221,
    1.4548,
    1.1467,
    0.9299,
    -0.5813,
    1.8233,
    0.589,
    -0.7549,
    -0.6225,
    0.3288,
    -0.0193,
    -0.0334,
    0.1986,
    0.2975,
    -0.3664,
    0.2193,
    0.8372,
    -1.1644,
    0.2274,
    0.9705,
    -0.8714,
    1.4641,
    1.3488,
    0.1091,
    -0.3177,
    -0.1882,
    -1.1594,
    1.2089,
    0.2977,
    -0.1566,
    -0.0051,
    1.1058,
    -0.3248,
    -1.2973,
    -1.3316,
    0.0142,
    -0.3959,
    -1.3865,
    -1.2727,
    0.6196,
    -0.8212,
    -1.3437,
    1.0395,
    -0.7507,
    -0.5489,
    -0.7784,
    -1.7778,
    -1.3312,
    0.8487,
    0.0294,
    0.1881,
    0.7646,
    0.4522,
    0.4678,
    -0.8277,
    0.041,
    1.1668,
    1.735,
    1.4254,
    0.4898,
    -0.93,
    -0.7098,
    -0.544,
    -0.5054,
    -0.3304,
    0.0628,
    -0.8398,
    -0.7657,
    0.349,
    -0.1379,
    -0.9503,
    -0.2914,
    1.1554,
    -0.0274,
    1.1115,
    1.936,
    -1.9018,
    -0.4166,
    -0.7103,
    2.1649,
    1.2314,
    -0.1635,
    -0.1107,
    -0.7105,
    -1.0551,
    -0.7786,
    -0.362,
    -1.5444,
    -0.6963,
    1.0831,
    1.3319,
    -0.0749,
    1.0396,
    -1.4443,
    0.1257,
    -1.1562,
    -1.3646,
    -0.1965,
    1.5619,
    0.3651,
    0.9046,
    -0.5618,
    -1.4522,
    -1.3642,
    0.1818,
    1.7873000000000001,
    0.605,
    1.2178,
    -0.9309,
    -0.126,
    -1.0827,
    0.4765,
    0.5231,
    0.8846,
    -0.0262,
    0.7589,
    0.7182,
    0.5455,
    1.1533,
    -0.3726,
    0.115,
    -1.218,
    1.4245,
    -1.7175,
    1.2001,
    -0.7959,
    0.3003,
    -0.2007,
    -0.6971,
    0.6267,
    -0.6013,
    -1.5463,
    -1.0415,
    -1.0638,
    -1.041,
    -1.086,
    -0.7781,
    -0.7843,
    -0.0673,
    0.1205,
    -0.1273,
    -1.3489,
    0.4102,
    0.1029,
    -0.5481,
    -0.0493,
    0.3696,
    1.1153,
    -0.4066,
    -0.3555,
    -0.4196,
    -1.009,
    0.9331,
    0.9089,
    -0.9941,
    -0.9434,
    1.1093,
    -0.3387,
    0.0442,
    2.1393,
    -0.2801,
    0.4678,
    -1.4077,
    1.0014,
    0.8926,
    1.7876,
    1.1369,
    -1.1392,
    -0.5199,
    -0.3995,
    1.7389,
    0.0047,
    -0.6506,
    -0.8149,
    -0.8866,
    0.4318,
    -0.2332,
    -1.5267,
    2.0807,
    1.4995,
    -0.527,
    0.1736,
    1.3757,
    0.9483,
    -0.3121,
    -1.1136,
    -1.3877,
    0.2161,
    -0.1896,
    -1.0273,
    1.6553,
    -0.5144,
    -1.2843,
    0.6364,
    -0.0703,
    -1.0566,
    0.6566,
    0.3906,
    -0.4043,
    -0.9651,
    -0.9916,
    0.7076,
    0.8354,
    -0.4929,
    -0.9727,
    2.1948,
    0.2202,
    0.366,
    0.8877,
    0.2967,
    1.2464,
    -0.861,
    1.299,
    -1.1691,
    -0.1924,
    0.1174,
    1.7787,
    -0.8642,
    -1.441,
    -1.1972,
    0.8149,
    1.4832,
    -0.0925,
    -0.8852,
    0.3344,
    0.7991,
    -0.8473,
    0.204,
    -1.8681,
    0.0034,
    1.2765,
    0.2239,
    -0.2401,
    0.7861,
    -0.1374,
    -0.2402,
    -1.1195,
    0.0589,
    -0.6249,
    0.2584,
    -0.0729,
    0.6771,
    1.3337,
    -1.1141,
    -1.1693,
    -1.4299,
    2.6951,
    -1.8612,
    -1.9585,
    0.8146,
    -0.704,
    0.7532,
    1.2777,
    -2.0778,
    0.9126,
    0.2824,
    0.4314,
    -0.9213,
    1.2339,
    -0.8941,
    1.2509,
    2.4199,
    -1.9666,
    0.8649,
    1.3398,
    -0.343,
    1.1672,
    1.0277,
    -0.3282,
    -1.4155,
    0.6788,
    1.2103,
    0.4838,
    0.8424,
    -1.1647,
    0.2107,
    0.4299,
    -1.8628,
    -1.868,
    0.776,
    -0.8467,
    -0.4442,
    0.1981,
    -0.3276,
    0.3548,
    -1.1932,
    -0.8323,
    -1.0825,
    1.4579,
    0.1543,
    1.126,
    2.3798,
    0.7686,
    0.6783,
    -0.0884,
    -1.7392,
    0.9831,
    0.4284,
    0.0065,
    -1.3368,
    -0.8437,
    0.1234,
    0.4283,
    0.4473,
    0.0387,
    -0.5618,
    -0.5416,
    -0.2683,
    2.2251,
    -0.4227,
    -0.0069,
    -0.1097,
    1.334,
    -0.1751,
    0.8626,
    -0.0458,
    -0.5243,
    0.0166,
    0.8128,
    -0.4324,
    0.0447,
    2.1143,
    1.0997,
    -0.4972,
    0.5078,
    0.5661,
    0.5194,
    0.4917,
    -0.1294,
    -1.5413,
    2.5076,
    -1.6423,
    -0.017,
    -1.3726,
    -0.5887,
    1.1088,
    -0.6942,
    -1.516,
    -1.2718,
    -0.9044,
    -1.9298,
    -0.6035,
    0.3029,
    -0.3066,
    0.1795,
    1.1869,
    -1.1852,
    0.6847,
    0.5121,
    0.0956,
    0.3555,
    -0.75,
    0.5528,
    0.5783,
    1.1518,
    -1.481,
    -0.2909,
    -0.5522,
    0.5544,
    -0.3647,
    1.1792,
    0.2092,
    -1.1752,
    -0.9527,
    -1.0542,
    1.1705,
    -1.1925,
    -0.5809,
    0.6464,
    0.5574,
    -1.694,
    0.2418,
    -0.7414,
    -1.9778,
    0.3357,
    -1.3232,
    -0.0272,
    1.8522,
    0.2455,
    -0.4227,
    0.5898,
    -0.841,
    -0.4528,
    -1.6274,
    0.6151,
    -0.4522,
    -1.0366,
    -1.4524,
    -0.973,
    -1.3772,
    -1.0181,
    0.3693,
    0.6343,
    1.2755,
    1.4356,
    -1.2712,
    -0.6942,
    -0.2786,
    -0.2691,
    0.914,
    0.1904,
    0.6283,
    -1.0022,
    0.8432,
    0.9987,
    0.4672,
    0.5502,
    0.0026,
    -0.7433,
    0.69,
    0.7099,
    0.0824,
    1.9596,
    0.8056,
    -1.2886,
    -0.2063,
    0.4394,
    1.3226,
    -0.1509
  )
)
